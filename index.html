<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Treino Matemática</title>

<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  background: #f4f6f8;
}

button {
  padding: 10px 18px;
  margin: 6px;
  font-size: 16px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  background: #2d6cdf;
  color: white;
}

button:hover {
  background: #1f4fa8;
}

input {
  padding: 10px;
  font-size: 26px;
  width: 120px;
  text-align: center;
}

#pergunta {
  font-size: 42px;
  margin: 60px 0 20px 0;
}
</style>
</head>
<body>

<h2>Treino de Matemática</h2>

<div>
  <input type="text" id="paciente" placeholder="Nome do paciente">
</div>

<hr>

<div id="menu">
  <button onclick="iniciar(['mais'])">n + n</button>
  <button onclick="iniciar(['x2'])">n x 2</button>
  <button onclick="iniciar(['xn'])">n x n</button>
  <button onclick="iniciar(['x5'])">n x 5</button>
  <br>
  <button onclick="iniciar(['mais','x2'])">n+n e n×2</button>
  <button onclick="iniciar(['mais','x2','xn'])">+ , x2 , xn</button>
  <button onclick="iniciar(['mais','x2','xn','x5'])">Todos</button>
</div>

<div id="areaQuiz" style="display:none;">
  <div id="pergunta"></div>
  <input type="number" id="resposta" autocomplete="off">
</div>

<script>

// ====== COLE SEU LINK AQUI ======
const URL = "https://script.google.com/macros/s/AKfycbzrKaaK1w5UbLKNRBJ9qwr45HupRSFB2E6ZqfS53lDHihZBzAzOhcI9ZYRQnrLhkHPndA/exec";
// =================================


// -------- GERAÇÃO --------

function gerarBase(tipo) {
  const contas = [];

  if (tipo === "mais") {
    for (let i = 1; i <= 9; i++) {
      contas.push({pergunta: `${i} + ${i}`, resposta: i + i});
    }
  }

  if (tipo === "x2") {
    for (let i = 1; i <= 9; i++) {
      contas.push({pergunta: `${i} x 2`, resposta: i * 2});
    }
  }

  if (tipo === "xn") {
    for (let i = 1; i <= 9; i++) {
      contas.push({pergunta: `${i} x ${i}`, resposta: i * i});
    }
  }

  if (tipo === "x5") {
    for (let i = 1; i <= 9; i++) {
      contas.push({pergunta: `${i} x 5`, resposta: i * 5});
    }
  }

  return contas;
}

function embaralhar(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

function gerarModulo(tipos) {
  let contas = [];

  tipos.forEach(tipo => {
    contas = contas.concat(gerarBase(tipo));
  });

  if (tipos.length === 1) {
    contas = contas.concat(contas);
  }

  return embaralhar(contas);
}


// -------- FLUXO SEQUENCIAL AUTOMÁTICO --------

let questoes = [];
let indiceAtual = 0;
let respostas = [];

function iniciar(tipos) {

  const nome = document.getElementById("paciente").value;
  if (!nome) {
    alert("Digite o nome do paciente.");
    return;
  }

  questoes = gerarModulo(tipos);
  indiceAtual = 0;
  respostas = [];

  document.getElementById("menu").style.display = "none";
  document.getElementById("areaQuiz").style.display = "block";

  mostrarPergunta();
}

function mostrarPergunta() {
  document.getElementById("pergunta").innerText =
    questoes[indiceAtual].pergunta;

  const campo = document.getElementById("resposta");
  campo.value = "";
  campo.focus();
}


// ENTER avança automaticamente
document.getElementById("resposta").addEventListener("keydown", function(e) {

  if (e.key === "Enter") {

    const valor = this.value;

    respostas.push({
      pergunta: questoes[indiceAtual].pergunta,
      correta: questoes[indiceAtual].resposta,
      respostaPaciente: valor
    });

    indiceAtual++;

    if (indiceAtual < questoes.length) {
      mostrarPergunta();
    } else {
      enviar();
    }
  }
});


// -------- ENVIO --------

function enviar() {

  const dados = {
    paciente: document.getElementById("paciente").value,
    dataHora: new Date().toLocaleString(),
    respostas: respostas
  };

  fetch(URL, {
    method: "POST",
    body: JSON.stringify(dados),
    headers: {
      "Content-Type": "application/json"
    }
  })
  .then(res => res.text())
  .then(() => {
    alert("Finalizado e enviado.");
    location.reload();
  })
  .catch(() => {
    alert("Erro ao enviar.");
  });
}

</script>

</body>
</html>
