<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Treino de Matemática</title>
<style>
body {
    font-family: Arial, sans-serif;
    text-align: center;
    margin-top: 100px;
}

h1 {
    font-size: 32px;
}

input, button {
    font-size: 22px;
    padding: 10px;
    margin-top: 20px;
}

button {
    cursor: pointer;
}

.hidden {
    display: none;
}

#feedback {
    font-size: 24px;
    margin-top: 20px;
}
</style>
</head>
<body>

<div id="home">
    <h1>Treino de Matemática</h1>
    <input type="text" id="nome" placeholder="Digite seu nome">
    <br>
    <button onclick="irParaMenu()">Entrar</button>
</div>

<div id="menu" class="hidden">
    <h1>Treino de Matemática</h1>
    <button onclick="iniciarTreino('soma')">n + n</button><br>
    <button onclick="iniciarTreino('x2')">n x 2</button><br>
    <button onclick="iniciarTreino('xx')">n x n</button><br>
    <button onclick="iniciarTreino('x5')">n x 5</button><br><br>

    <button onclick="iniciarTreino('combo1')">(n + n) e (n x 2)</button><br>
    <button onclick="iniciarTreino('combo2')">(n + n) e (n x 2) e (n x n)</button><br>
    <button onclick="iniciarTreino('combo3')">(n + n) e (n x 2) e (n x n) e (n x 5)</button>
</div>

<div id="treino" class="hidden">
    <div id="conta" style="font-size:40px;"></div>
    <input type="number" id="resposta">
    <br>
    <button onclick="enviarResposta()">Enviar</button>
    <div id="feedback"></div>
</div>

<div id="final" class="hidden">
    <h1>Treino finalizado</h1>
    <button onclick="voltarMenu()">Voltar ao menu principal</button>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzrKaaK1w5UbLKNRBJ9qwr45HupRSFB2E6ZqfS53lDHihZBzAzOhcI9ZYRQnrLhkHPndA/exec";

let nomeAluno = "";
let questoes = [];
let indice = 0;
let inicioQuestao;
let inicioTotal;
let resultados = [];

document.getElementById("nome").focus();

document.getElementById("resposta").addEventListener("keydown", function(e){
    if(e.key === "Enter"){
        enviarResposta();
    }
});

function irParaMenu(){
    nomeAluno = document.getElementById("nome").value.trim();
    if(nomeAluno === ""){
        alert("Digite seu nome.");
        return;
    }
    document.getElementById("home").classList.add("hidden");
    document.getElementById("menu").classList.remove("hidden");
}

function gerarQuestoes(tipo){
    let lista = [];

    function soma(){ for(let i=1;i<=9;i++) lista.push({q:`${i} + ${i}`, r:i+i}); }
    function x2(){ for(let i=1;i<=9;i++) lista.push({q:`${i} x 2`, r:i*2}); }
    function xx(){ for(let i=1;i<=9;i++) lista.push({q:`${i} x ${i}`, r:i*i}); }
    function x5(){ for(let i=1;i<=9;i++) lista.push({q:`${i} x 5`, r:i*5}); }

    if(tipo==="soma"){ soma(); soma(); }
    if(tipo==="x2"){ x2(); x2(); }
    if(tipo==="xx"){ xx(); xx(); }
    if(tipo==="x5"){ x5(); x5(); }

    if(tipo==="combo1"){ soma(); x2(); }
    if(tipo==="combo2"){ soma(); x2(); xx(); }
    if(tipo==="combo3"){ soma(); x2(); xx(); x5(); }

    return lista.sort(()=>Math.random()-0.5);
}

function iniciarTreino(tipo){
    questoes = gerarQuestoes(tipo);
    indice = 0;
    resultados = [];
    inicioTotal = Date.now();

    document.getElementById("menu").classList.add("hidden");
    document.getElementById("treino").classList.remove("hidden");

    mostrarQuestao();
}

function mostrarQuestao(){
    document.getElementById("feedback").innerText = "";
    document.getElementById("resposta").value = "";
    document.getElementById("resposta").focus();
    document.getElementById("conta").innerText = questoes[indice].q;
    inicioQuestao = Date.now();
}

function enviarResposta(){
    let respostaInput = document.getElementById("resposta").value.trim();
    if(respostaInput === ""){
        alert("Você precisa responder algo.");
        return;
    }

    let tempoQuestao = (Date.now() - inicioQuestao)/1000;
    let tempoFormatado = tempoQuestao.toFixed(2).replace(".", ",");

    let correta = Number(respostaInput) === questoes[indice].r;
    let status = correta ? "certo" : "errado";

    document.getElementById("feedback").innerText = 
        correta ? "Correto!" : `Incorreto. A resposta era ${questoes[indice].r}`;

    resultados.push({
        nome: nomeAluno,
        pergunta: questoes[indice].q,
        resposta: respostaInput,
        status: status,
        tempo_item: tempoFormatado
    });

    indice++;

    setTimeout(()=>{
        if(indice < questoes.length){
            mostrarQuestao();
        } else {
            finalizarTreino();
        }
    },1000);
}

function finalizarTreino(){
    let tempoTotal = (Date.now() - inicioTotal)/1000;
    let tempoTotalFormatado = tempoTotal.toFixed(2).replace(".", ",");

    resultados.forEach(r => r.tempo_total = tempoTotalFormatado);

    fetch(SCRIPT_URL, {
        method: "POST",
        body: JSON.stringify(resultados),
        headers: { "Content-Type": "application/json" }
    });

    document.getElementById("treino").classList.add("hidden");
    document.getElementById("final").classList.remove("hidden");
}

function voltarMenu(){
    document.getElementById("final").classList.add("hidden");
    document.getElementById("menu").classList.remove("hidden");
}
</script>

</body>
</html>
